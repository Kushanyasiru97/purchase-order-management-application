<p-toast />

<div class="screen-content">
  <div class="panel-wrapper border border-gray-300 rounded-[16px] p-2 h-100">
    <div class="row">
      <div class="col-md-12">
        <app-top-panel
          [config]="topPanelConfig"
          [dateRange]="dateRange"
          (filtersChange)="onFiltersChange($event)"
          (customButtonClick)="openCreateNewOrder()"
          [btnColor]="searchColor"
        ></app-top-panel>
      </div>

      <div class="col-md-12 mt-3">
        <!-- Loading State -->
        <div *ngIf="loading" class="text-center py-5">
          <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
          <p class="mt-3 text-gray-600">Loading purchase orders...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && visibleProducts.length === 0" class="text-center py-5 border border-gray-200 rounded-xl">
          <i class="pi pi-inbox" style="font-size: 3rem; color: #9ca3af"></i>
          <h2 class="mt-3 text-lg font-semibold text-gray-700">No Purchase Orders Found</h2>
        </div>

        <!-- Table with Data -->
        <div *ngIf="!loading && visibleProducts.length > 0" class="rounded-xl overflow-hidden border border-[#E5E6E6]">
          <p-table
            [value]="visibleProducts"
            [tableStyle]="{ width: '100%' }"
            [scrollable]="true"
            scrollHeight="450px"
            class="p-table"
          >
            <ng-template pTemplate="header">
              <tr class="table-header-row">
                <th pSortableColumn="po_number" style="width: 10%" class="text-left">
                  <div class="flex items-center gap-1">
                    PO Number
                    <p-sortIcon field="po_number"></p-sortIcon>
                  </div>
                </th>
                <th style="width: 20%" class="text-center">
                  <div class="flex items-center gap-1 justify-center">
                    Supplier Name  
                  </div>
                </th>
                <th pSortableColumn="order_date" style="width: 10%" class="text-center">
                  <div class="flex items-center gap-1 justify-center">
                    Order Date
                    <p-sortIcon field="order_date"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="total_amount" style="width: 15%" class="text-center">
                  <div class="flex items-center gap-1 justify-center">
                    Total Amount
                    <p-sortIcon field="total_amount"></p-sortIcon>
                  </div>
                </th>
                <th style="width: 20%" class="text-center">
                  <div>Description</div>
                </th>
                <th style="width: 10%" class="text-center">
                  <div>Status</div>
                </th>
                <th style="width: 15%" class="text-center">
                  <div>Actions</div>
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-order>
              <tr class="table-body-row font-14">
                <td class="text-left">{{ order.po_number }}</td>
                <td class="text-center">{{ order.supplier }}</td>
                <td class="text-center">{{ formatDate(order.order_date) }}</td>
                <td class="text-center ">{{ formatCurrency(order.total_amount) }}</td>
                <td class="text-center">{{ truncateText(order.po_description)}}</td>
                <td class="text-center">
                  <span 
                    class="status-badge" 
                    [ngClass]="getStatusClass(order.status)"
                  >
                    {{ order.status }}
                  </span>
                </td>
                <td>
                  <div class="btn-wrapper flex items-center justify-center gap-2">
                    <button
                      pButton
                      type="button"
                      icon="pi pi-pen-to-square"
                      class="btn-primary font-12 flex items-center justify-center"
                      style="width: 32px; height: 32px; min-width: 32px"
                      (click)="openEditOrder(order)" 
                      title="Edit"
                    ></button>

                    <button
                      pButton
                      type="submit"
                      icon="pi pi-trash"
                      class="btn-danger font-12 flex items-center justify-center"
                      style="width: 32px; height: 32px; min-width: 32px"
                      (click)="openConfirmDelete(order.id)" 
                      title="Delete"
                    ></button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        
        <div *ngIf="!loading && visibleProducts.length > 0" class="row mt-2">
          <app-paginator
            [totalRecords]="totalRecords"
            [rows]="rows"
            [first]="first"
            (paginationChanged)="onPaginationChanged($event)"
          >
          </app-paginator>
        </div>
      </div>
    </div>
  </div>
</div>

<app-side-form
  [visible]="sidebarVisible"
  [title]="sidebarTitle"
  [subtitle]="sidebarSubtitle"
  [acceptButtonLabel]="acceptButtonLabel"
  closeButtonLabel="Close"
  [showAcceptButton]="true"
  [formData]="formData"
  (visibleChange)="onSideFormVisibleChange($event)"
  (formDataChange)="onFormDataChange($event)"
  (acceptClicked)="validateAndConfirmAccept()"
  (closeClicked)="closeSidebar()"
></app-side-form>

<app-confirm-dialog
  [visible]="showConfirm"
  [message]="confirmMessage"
  [header]="confirmHeader"
  [showReject]="confirmShowReject"
  [showDelete]="confirmShowDelete"
  [showConfirm]="confirmShow"
  (accept)="handleAccept()"
  (reject)="handleReject()"
  (delete)="handleDelete()"
></app-confirm-dialog>